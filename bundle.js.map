{
  "version": 3,
  "sources": [
    "../../Users/cheahshen/AppData/Roaming/npm/node_modules/ksana-cli/node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "../cbeta-address/codec.js",
    "../node_modules/ksana2015-parallel/index.js",
    "../node_modules/ksana2015-parallel/src/cmview.js",
    "../node_modules/ksana2015-parallel/src/controlpanel.js",
    "../node_modules/ksana2015-parallel/src/inputbox.js",
    "../node_modules/ksana2015-parallel/src/kepan.js",
    "../node_modules/ksana2015-parallel/src/loadfile.js",
    "../node_modules/ksana2015-parallel/src/model.js",
    "../node_modules/ksana2015-parallel/src/notepopup.js",
    "../node_modules/ksana2015-parallel/src/taishoview.js",
    "../node_modules/ksana2015-parallel/src/tocresult.js",
    "../node_modules/ksana2015-parallel/src/toprightmenu.js",
    "../node_modules/ksana2015-parallel/src/twocolumn.js",
    "../node_modules/ksana2015-parallel/src/twocolumnmode.js",
    "../node_modules/ksana2015-treetoc/addnode.js",
    "../node_modules/ksana2015-treetoc/controls.js",
    "../node_modules/ksana2015-treetoc/index.js",
    "../node_modules/ksana2015-treetoc/manipulate.js",
    "../node_modules/ksana2015-treetoc/treenode.js",
    "../node_modules/ksana2015-webruntime/downloader.js",
    "../node_modules/ksana2015-webruntime/html5fs.js",
    "../node_modules/ksana2015-webruntime/ksanagap.js",
    "../node_modules/ksana2015-webruntime/livereload.js",
    "../node_modules/ksana2015-webruntime/mkdirp.js",
    "index.js",
    "src/main.jsx",
    "src/rule.js",
    "src/toprightmenu.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1FA;AACA;AACA;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "var pat=/[A-Z]?(\\d{2,3})p(\\d\\d\\d\\d)([abcd])(\\d\\d)(\\d\\d)/\r\nvar sides={a:0,b:1,c:2,d:3};\r\nvar pack=function(str){\r\n\tvar r=str.match(pat);\r\n\tif (!r) return null;\r\n\r\n\tvar side=sides[r[3]];\r\n\tvar vol=parseInt(r[1],10), page=parseInt(r[2],10);\r\n\tvar line=parseInt(r[4],10), ch=parseInt(r[5]);\r\n\tvar r={ vol,page,side,line,ch};\r\n\treturn compose( r);\r\n}\r\n\r\nvar decompose=function(c){\r\n\tvar ch=c%32;\r\n\tvar line=Math.floor((c/32)%32);\r\n\tvar side=Math.floor((c/1024)%4);\r\n\tvar page=Math.floor((c/4096)%2048);\r\n\tvar vol=Math.floor((c/8388608)%128);\r\n\r\n\tvar r={vol,page,side,line,ch };\r\n\treturn r;\r\n}\r\nvar compose=function(r) {\r\n\tvar res=r.vol*8388608 //Vol\r\n\t+r.page*4096  //pg\r\n\t+r.side*1024               //side\r\n\t+r.line*32    //line\r\n\t+r.ch;      //ch\r\n\treturn res;\r\n}\r\n//faster than decompose\r\nvar charOf=function(c){\r\n\treturn c%32;\r\n}\r\nvar lineOf=function(c){\r\n\treturn Math.floor((c/32)%32);\r\n}\r\nvar pageOf=function(c){\r\n\treturn Math.floor((c/4096)%2048);\r\n}\r\nvar sideOf=function(c){\r\n\treturn Math.floor((c/1024)%4);\r\n}\r\nvar volOf=function(c){\r\n\tMath.floor((c/8388608)%128);\r\n}\r\n\r\nvar unpack=function(pointer){\r\n\tvar r=decompose(pointer);\r\n\tr.ch=\"0\"+r.ch; r.ch=r.ch.substr(r.ch.length-2);\r\n\tr.line=\"0\"+r.line; r.line=r.line.substr(r.line.length-2);\r\n\tr.side=[\"a\",\"b\",\"c\",\"d\"][r.side];\r\n\tr.page=\"000\"+r.page; r.page=r.page.substr(r.page.length-4);\r\n\tr.vol=\"0\"+r.vol; r.vol=r.vol.substr(r.vol.length-2);\r\n\r\n\tvar q=r.vol+\"p\"+r.page+r.side+r.line+r.ch;\r\n\treturn q;\r\n}\r\n//cannot cross volumn\r\nvar lineDistance=function(p1,p2){\r\n\treturn (pageOf(p2)*87+sideOf(p2)*29+lineOf(p2) )\r\n\t- (pageOf(p1)*87+sideOf(p1)*29+lineOf(p1));\r\n}\r\n\r\nvar nextLine=function(pointer,advanceline){\r\n\tvar d=decompose(pointer);\r\n\tadvanceline=advanceline||1;\r\n\r\n\twhile (advanceline) {//naive...room to improve\r\n\t\tif (d.line==29) {\r\n\t\t\tif (d.side==2) {\r\n\t\t\t\td.side=0;\r\n\t\t\t\td.page++;\r\n\t\t\t} else {\r\n\t\t\t\td.side++;\r\n\t\t\t}\r\n\t\t\td.line=1;\r\n\t\t} else {\r\n\t\t\td.line++;\r\n\t\t}\t\t\r\n\t\tadvanceline--;\r\n\t}\r\n\r\n\treturn compose(d);\r\n}\r\n//A range =  delta<<32 + pointer\r\n//delta should not cross a juan , less than 16 bits\r\n\r\nmodule.exports={pack,unpack,compose,decompose,nextLine\r\n,charOf,lineOf,sideOf,pageOf,volOf,lineDistance}",
    "var model=require(\"./src/model\");\r\nvar TwoColumnMode=require(\"./src/twocolumnmode\");\r\nmodule.exports={model,TwoColumnMode};",
    "var React=require(\"react\");\r\nvar ReactDOM=require(\"react-dom\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar CodeMirror=require(\"ksana-codemirror\").Component;\r\nvar TopRightMenu=require(\"./toprightmenu\");\r\nvar NotePopup=require(\"./notepopup\");\r\nrequire(\"./loadfile\");\r\n\r\nvar CMView=React.createClass({\r\n\tgetInitialState:function(){\r\n\t\treturn {data:this.props.data||\"empty\",popupX:0,popupY:0,popupText:\"\"}\r\n\t}\r\n\t,contextTypes:{\r\n\t\tstore:PT.object,\r\n\t\tgetter:PT.func,\r\n\t\taction:PT.func\r\n\t}\r\n\t,componentWillReceiveProps:function(nextProps) {\r\n\t\tif (nextProps.doc!==this.props.doc) {\r\n\t\t\tthis.context.getter(\"file\",{filename:nextProps.doc,side:nextProps.side});\t\r\n\t\t}\r\n\t}\r\n\t,defaultListeners:function(){\r\n\t\tthis.context.store.listen(\"gopara\",this.onGoPara,this);\r\n\t\tthis.context.store.listen(\"leavingfrom\",this.onLeavingFrom,this);\r\n\t\tthis.context.store.listen(\"gokepan\",this.onGoKepan,this);\r\n\t\tthis.context.store.listen(\"loaded\",this.onLoaded,this);\r\n\t\tthis.context.store.listen(\"showfootnote\",this.showfootnote,this);\r\n\t\tthis.context.store.listen(\"hidefootnote\",this.hidefootnote,this);\r\n\t}\r\n\t,hasFootnoteInScreen:function(note){\r\n\t\tvar screentext=this.getScreenText();\r\n\t\tvar rule=this.getDocRule();\r\n\t\tvar n=rule.makeFootnote(note);\r\n\t\tvar m=screentext.match(rule.patterns.footnote);\r\n\t\tif (m) {\r\n\t\t\tvar at=m.indexOf(n);\r\n\t\t\treturn at>-1;\r\n\t\t}\t\r\n\t\treturn false;\r\n\t}\r\n\t,leavingFrom:null\r\n\t,leavingClass:\"\"\r\n\t,onLeavingFrom:function(link){\r\n\t\tif(this.leavingFrom) {\r\n\t\t\t\tthis.leavingFrom.replacedWith.className=this.leavingClass;\r\n\t\t\t\tthis.leavingFrom=null;\r\n\t\t}\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\t\tvar screentext=this.getScreenText();\r\n\t\tvar vp=cm.getViewport();\r\n\t\tvar i=screentext.indexOf(link);\r\n\t\tif (i>-1) {\r\n\t\t\tvar pos=cm.posFromIndex(i+cm.indexFromPos({line:vp.from,ch:1}));\r\n\t\t\tvar marks=cm.findMarks(pos,{line:pos.line,ch:pos.ch+link.length});\r\n\t\t\tif (marks&&marks.length) for (var i=0;i<marks.length;i++) {\r\n\t\t\t\tvar m=marks[i];\r\n\t\t\t\tif (m.replacedWith) {\r\n\t\t\t\t\tthis.leavingClass=m.replacedWith.className;\r\n\t\t\t\t\tthis.leavingFrom=m;\r\n\t\t\t\t\tm.replacedWith.className=\"link_visited\";\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t,popupFootnote:function(){\r\n\t\t\tvar rule=this.getDocRule();\r\n\t\t\tvar ndeffile=rule.getNoteFile(this.note);\r\n\t\t\tvar ndefs=this.context.getter(\"fileSync\",ndeffile);\r\n\t\t\tthis.setState({popupX:this.popupX,popupY:this.popupY,\r\n\t\t\t\tpopupW:this.popupW,popupH:this.popupH,\r\n\t\t\t\tpopupText:ndefs[this.note]})\r\n\t}\r\n\t,showfootnote:function(opts){\r\n\t\tif (this.hasFootnoteInScreen(opts.note)){\r\n\t\t\tvar n=ReactDOM.findDOMNode(this).getBoundingClientRect();\r\n\t\t\tthis.popupX=opts.x-n.left; this.popupY=opts.y-n.top;\r\n\t\t\tthis.popupW=n.width; this.popupH=n.height;\r\n\t\t\tthis.note=opts.note;\r\n\t\t\tthis.loadNote(opts.note);\r\n\t\t}\r\n\t}\r\n\t,hidefootnote:function(note){\r\n\t\tif (this.hasFootnoteInScreen(note)){\r\n\r\n\t\t}\r\n\t}\r\n\t,componentDidMount:function(){\r\n\t\tthis.defaultListeners();\r\n\t\tif (this.props.doc) {\r\n\t\t\tthis.context.getter(\"file\",{filename:this.props.doc,side:this.props.side});\r\n\t\t}\r\n\t}\r\n\t,getScreenText:function(){\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\t\tvar vp=cm.getViewport();\r\n\t\tvar rule=this.getDocRule();\r\n\t\tvar t=\"\";\r\n\t\tfor (var i=vp.from;i<=vp.to;i++) {\r\n\t\t\tt+=cm.doc.getLine(i)+\"\\n\";\r\n\t\t}\r\n\t\treturn t;\r\n\t}\r\n\t,scrollToText:function(t){\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\t\tvar text=cm.getValue();\r\n\t\tvar at=text.indexOf(t);\r\n\t\tif (at>-1) {\r\n\t\t\tvar pos=cm.doc.posFromIndex(at);\r\n\t\t\t//scroll to last line , so that the paragraph will be at top\r\n\t\t\tcm.scrollIntoView({line:cm.doc.lineCount()-1,ch:0})\r\n\t\t\tif (pos.line) pos.line--;\r\n\t\t\tcm.scrollIntoView(pos);\r\n\t\t}\r\n\t}\r\n\t/*\r\n\t\t\tvar screentext=this.getScreenText();\r\n\t*/\r\n\t,onGoKepan:function(kepan) {\r\n\t\tvar rule=this.getDocRule();\r\n\t\tvar kepantext=rule.makeKepan(kepan+\" \");//prevent 37.1 jump to 37.10\r\n\t\tthis.scrollToText(kepantext);\r\n\t}\r\n\t,onGoPara:function(para){\r\n\t\tvar rule=this.getDocRule();\r\n\t\tvar paratext=rule.makeParagraph(para);\r\n\t\tthis.scrollToText(paratext);\r\n\t}\r\n\t,onNDefLoaded:function(arg){\r\n\t\tthis.context.store.unlistenAll(this);\r\n\t\tthis.defaultListeners();\r\n\t\tthis.popupFootnote();\r\n\t}\r\n\t,markViewport:function(){\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\t\tvar vp=cm.getViewport();\r\n\t\tthis.vpfrom=-1;//force onViewport\r\n\t\tthis.onViewportChange(cm,vp.from,vp.to);\r\n\t\tvar rule=this.getDocRule();\r\n\t}\r\n\t,loadNote:function(note){\r\n\t\tvar rule=this.getDocRule();\r\n\t\tvar filename=rule.getNoteFile(note);\r\n\t\tvar d=this.context.getter(\"fileSync\",filename);\r\n\t\tif (d){\r\n\t\t\tthis.popupFootnote();\r\n\t\t} else {\r\n\t\t\tthis.context.store.unlistenAll(this);\r\n\t\t\tthis.context.store.listen(\"loaded\",this.onNDefLoaded,this);\r\n\t\t\tthis.context.getter(\"file\",{filename,side:this.props.side});\r\n\t\t}\r\n\t}\r\n\t,onCursorActivity:function(cm){\r\n\t\t//var c=cm.doc.getCursor();\r\n\t\t//if (this.activeline==c.line) return;\r\n\t\t//this.loadNote(cm,c.line);\r\n\t}\r\n\t,onSetDoc:function(side,filename){\r\n\t\tthis.context.getter(\"setDoc\",side,filename);\r\n\t}\r\n\t,getDocRule:function(doc){\r\n\t\tdoc=doc||this.props.doc;\r\n\t\tvar docs=this.props.docs;\r\n\t\tfor (var i=0;i<docs.length;i++) {\r\n\t\t\tif (docs[i].name==this.props.doc) {\r\n\t\t\t\treturn docs[i].rule;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t,onLoaded:function(res){\r\n\t\tif (res.side!==this.props.side) return;\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\r\n\t\tvar rule=this.getDocRule();\r\n\t\trule.setActionHandler(this.context.action);\r\n\t\tcm.setValue(res.data);\r\n\t}\r\n\t,onViewportChange:function(cm,from,to) {\r\n\t\tvar rule=this.getDocRule();\r\n\t\tif (!rule)return;\r\n\r\n\t\tvar clearMarksBeyondViewport=function(f,t){\r\n\t\t\tvar M=cm.doc.findMarks({line:0,ch:0},{line:f-1,ch:65536});\r\n\t\t\tM.forEach(function(m){m.clear()});\r\n\r\n\t\t\tvar M=cm.doc.findMarks({line:0,ch:t},{line:cm.lineCount(),ch:65536});\r\n\t\t\tM.forEach(function(m){m.clear()});\t\t\t\r\n\t\t}\t\t\r\n\r\n\t\tif (this.vptimer) clearTimeout(this.vptimer);\r\n\t\tthis.vptimer=setTimeout(function(){ //marklines might trigger viewport change\t\t\t\r\n\t\t\t//rule.clearNote();\r\n\t\t\tvar vp=cm.getViewport(); //use current viewport instead of from,to\r\n\t\t\tif (Math.abs(this.vpfrom-vp.from)<2)return;\r\n\t\t\t\r\n\t\t\t//this will trigger another onViewport\r\n\t\t\t//clearMarksBeyondViewport(vp.from,vp.to+10);\r\n\r\n\t\t\trule.markLines(cm,vp.from,vp.to+20,{note:true,pagebreak:true,link:true});\r\n\t\t\tthis.vpfrom=vp.from,this.vpto=vp.to;\r\n\t\t}.bind(this),400); \r\n\t\t//might be big enough, otherwise onViewport will be trigger again, causing endless loop\r\n\t}\r\n\t,render:function(){\r\n\t\tvar rule=this.getDocRule();\r\n\t\treturn E(\"div\",{},\r\n\t\t\tE(NotePopup,{x:this.state.popupX,y:this.state.popupY,\r\n\t\t\t\tw:this.state.popupW,h:this.state.popupH,\r\n\t\t\t\trule,\r\n\t\t\t\ttext:this.state.popupText}),\r\n\t\t\tE(TopRightMenu,{side:this.props.side,onSetDoc:this.onSetDoc,\r\n\t\t\t\tbuttons:this.props.docs,selected:this.props.doc}),\r\n\t  \tE(CodeMirror,{ref:\"cm\",value:\"\",theme:\"ambiance\",readOnly:true,\r\n  \t  onCursorActivity:this.onCursorActivity\r\n  \t  ,onViewportChange:this.onViewportChange})\r\n  \t )\r\n\t}\r\n})\r\nmodule.exports=CMView;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar Tabs={kepan:require(\"./kepan\")}\r\nvar ControlPanel = React.createClass({\r\n  getInitialState:function() {\r\n    return {order:0};\r\n  }\r\n  ,render:function(){\r\n    var Tab=Tabs[this.props.ControlTab];\r\n  \treturn E(\"div\",{style:this.props.style},\r\n        Tab?E(Tab):null\r\n    );\r\n  }\r\n});\r\n\r\nmodule.exports=ControlPanel;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar InputBox=React.createClass({\r\n\tgetInitialState:function(){\r\n\t\treturn {tofind:\"\",order:1,focusing:false}\r\n\t}\r\n\t,propTypes:{\r\n\t\tonInputChanged:PT.func.isRequired\r\n\t}\r\n  ,onChange:function(e){\r\n    var tofind=e.target.value;\r\n    this.setState({tofind});\r\n    clearTimeout(this.timer1);\r\n    this.timer1=setTimeout(function(){\r\n    \tthis.props.onInputChanged(this.state.tofind,this.state.order);\r\n    }.bind(this),300);\r\n  }\r\n  ,onChangeOrder:function(e){\r\n  \tvar order=parseInt(e.target.value);\r\n  \tclearTimeout(this.timer2);\r\n  \tthis.refs.input.focus();\r\n  \tthis.setState({order});\r\n  \tthis.props.onInputChanged(this.state.tofind,order);\r\n  }\r\n  ,sortOption:function(){\r\n  \tif (this.state.tofind.trim() && this.state.focusing) {\r\n  \t\treturn [\r\n  \t\t  E(\"br\",{key:1})\r\n        ,E(\"label\",{key:2},E(\"input\",{onChange:this.onChangeOrder,\r\n        \tname:\"order\",type:\"radio\",value:1,defaultChecked:true}),\"Natural\")\r\n        ,E(\"label\",{key:3},E(\"input\",{onChange:this.onChangeOrder,\r\n        \tname:\"order\",type:\"radio\",value:2}),\"Depth\")\r\n        ,E(\"label\",{key:4},E(\"input\",{onChange:this.onChangeOrder,\r\n        \tname:\"order\",type:\"radio\",value:3}),\"Length\")\r\n      ]\r\n  \t}\r\n  }\r\n  ,onFocus:function(){\r\n  \tthis.setState({focusing:true});\r\n  }\r\n  ,onBlur:function(){\r\n  \tclearTimeout(this.timer2);\r\n  \tthis.timer2=setTimeout(function(){\r\n  \t\tthis.setState({focusing:false});\r\n  \t}.bind(this),500);\r\n  }\r\n\t,render:function(){\r\n\t\treturn E(\"div\",{style:styles.inputBox},\r\n        E(\"input\",{placeholder:\"Search\",style:styles.input,\r\n        \tref:\"input\",\r\n        \tonFocus:this.onFocus,\r\n        \tonBlur:this.onBlur,\r\n          value:this.state.tofind,onChange:this.onChange})\r\n        ,this.sortOption()\r\n     );\r\n  }\r\n});\r\nmodule.exports=InputBox;\r\nvar styles={\r\n  inputBox:{position:\"fixed\",zIndex:200, left:15,top:10,opacity:0.6},\r\n  input:{fontSize:\"120%\", width:210,borderRadius:5,background:\"silver\",outline:\"none\",border:\"0px\"}\r\n}",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar TreeToc=require(\"ksana2015-treetoc\").Component;\r\nvar TocResult=require(\"./tocresult\");\r\nvar InputBox=require(\"./inputbox\");\r\nvar KepanPanel = React.createClass({\r\n  getInitialState:function() {\r\n    return {filename:\"jin\",toc:[],tofind:\"\",order:0};\r\n  }\r\n  ,contextTypes:{\r\n  \tstore:PT.object.isRequired,\r\n  \tgetter:PT.func.isRequired,\r\n  \taction:PT.func.isRequired\r\n  }\r\n  ,componentDidMount:function(){\r\n    this.context.getter(\"file\",\"kepan\");\r\n    this.context.store.listen(\"loaded\",this.treeloaded,this);\r\n  }\r\n  ,treeloaded:function(obj){\r\n    if (obj.filename!==\"kepan\")return;\r\n  \tthis.setState({toc:obj.data});\r\n  }\r\n  ,onSelect:function(ctx,node,i,nodes){\r\n    this.context.action(\"gokepan\",node.l);\r\n  }\r\n  ,renderToc:function(){\r\n    if(this.state.tofind.trim()){\r\n      return [E(\"br\",{key:1}),\r\n        E(TocResult,{key:2,tofind:this.state.tofind,toc:this.state.toc\r\n        ,order:this.state.order\r\n        ,onSelect:this.onSelect})\r\n        ];\r\n    }else{\r\n      return E(TreeToc,{opts:{rainbow:true},\r\n        toc:this.state.toc,onSelect:this.onSelect});\r\n    }\r\n  }\r\n  ,onInputChanged:function(tofind,order){\r\n    this.setState({tofind,order});\r\n  }\r\n  ,render:function(){\r\n  \treturn E(\"div\",{style:this.props.style},\r\n      E(InputBox,{onInputChanged:this.onInputChanged}), \r\n      E(\"br\"),\r\n      this.renderToc()\r\n    );\r\n  }\r\n});\r\n\r\nmodule.exports=KepanPanel;",
    "/* jsonp loading text dynamically */\r\nvar {action,store,getter,registerGetter}=require(\"./model\");\r\n\r\nvar loadqueue=[];\r\nvar running=false;\r\n\r\nvar fireEvent=function(){\r\n\tif (loadqueue.length===0) {\r\n\t\trunning=false;\r\n\t\treturn;\r\n\t}\r\n\trunning=true;\r\n\tvar task=loadqueue.pop();\r\n\tvar func=task[0], opts=task[1], cb=task[2], context=task[3];\r\n\tfunc.call(context,opts);\r\n}\r\n\r\nvar queueTask=function(func,opts,cb,context) {\r\n\tloadqueue.unshift([func,opts,cb,context]);\r\n\tif (!running) fireEvent();\r\n}\r\nvar loadfile=function(obj){\r\n\tqueueTask(_loadfile,obj);\r\n}\r\nvar datafiles={};\r\nvar loadingfilename=\"\";\r\nvar loadingobj=null;\r\nvar loadscriptcb=function(data){\r\n\tif (!loadingfilename) {\r\n\t\tthrow \"not loading any file\"\r\n\t\treturn;\r\n\t}\r\n\tdatafiles[loadingfilename]=data;\r\n\r\n\tif (loadingobj) {\r\n\t\tvar o=JSON.parse(JSON.stringify(loadingobj));\r\n\t\to.data=data;\r\n\t} else {\r\n\t\tvar o={filename:loadingfilename,data};\r\n\t}\r\n\t\r\n\taction(\"loaded\",o);\r\n\tloadingfilename=\"\";\r\n\tloadingobj=null;\r\n\tsetTimeout(fireEvent,0);\r\n}\r\nwindow.loadscriptcb=loadscriptcb;\r\n\r\nvar _loadfile=function(obj){\r\n\tif (loadingfilename) return;\r\n\r\n\tif (typeof obj==\"string\") {\r\n\t\tfilename=obj;\r\n\t\tobj=null;\r\n\t} else {\r\n\t\tfilename=obj.filename;\r\n\t}\r\n\tif (!filename) {\r\n\t\tthrow \"Missing filename\"\r\n\t}\r\n\tif (datafiles[filename]) {\r\n\t\to=JSON.parse(JSON.stringify(obj));\r\n\t\to.data=datafiles[filename];\r\n\t\taction(\"loaded\",o);\r\n\t\tsetTimeout(fireEvent,0);\r\n\t} else {\r\n\t\tloadingfilename=filename;\r\n\t\tloadingobj=obj;\r\n\t\tvar script = document.createElement('script');\r\n\t\tscript.src = 'data/'+filename+\".js\";\r\n\t\tdocument.getElementsByTagName('head')[0].appendChild(script);\r\n\t}\r\n}\r\nvar fileSync=function(filename){\r\n\treturn datafiles[filename];\r\n}\r\nregisterGetter(\"file\",loadfile);\r\nregisterGetter(\"fileSync\",fileSync);//make sure already loaded\r\nmodule.exports=loadfile;",
    "/* action dispatcher */\r\nvar listeners=[];\r\nvar getters={};\r\n\r\nvar eventqueue=[];\r\nvar running=false;\r\n\r\nvar fireEvent=function(){\r\n\tif (eventqueue.length===0) {\r\n\t\trunning=false;\r\n\t\treturn;\r\n\t}\r\n\trunning=true;\r\n\r\n\tvar task=eventqueue.pop();\r\n\tvar func=task[0], opts=task[1], cb=task[2], context=task[3];\r\n\r\n\tif (func.length>1){\r\n\t\tfunc.call(context,opts,function(err,res,res2){\r\n\t\t\tcb&&cb(err,res,res2);\r\n\t\t\tsetTimeout(fireEvent,0);\r\n\t\t});\r\n\t} else { //sync func\r\n\t\tfunc.call(context,opts);\r\n\t\tsetTimeout(fireEvent,0);\r\n\t}\r\n}\r\n\r\nvar queueTask=function(func,opts,cb,context) {\r\n\teventqueue.unshift([func,opts,cb,context]);\r\n\tif (!running) setTimeout(fireEvent,0);\r\n}\r\n\r\nvar action=function(evt,opts,cb){\r\n\tfor (var i=0;i<listeners.length;i+=1) {\r\n\t\tvar listener=listeners[i];\r\n\t\tif (evt===listener[1] ) {\r\n\t\t\tif (listener[2]==undefined) {\r\n\t\t\t\tconsole.error(\"action has no callback\",evt,listener);\r\n\t\t\t}\r\n\t\t\tqueueTask( listener[2], opts,cb  , listener[0]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar getter=function(name,opts,cb){ // sync getter\r\n\tif (getters[name]) {\r\n\t\treturn getters[name](opts,cb);\r\n\t} else {\r\n\t\tconsole.error(\"getter '\"+name +\"' not found\");\r\n\t}\r\n}\r\nvar hasGetter=function(name) {\r\n\treturn (!!getters[name]);\r\n}\r\nvar registerGetter=function(name,cb,opts){\r\n\topts=opts||{};\r\n\tif (!cb && name) delete getters[name];\r\n\telse {\r\n\t\tif (getters[name] && !opts.overwrite) {\r\n\t\t\tconsole.error(\"getter name \"+name+\" overwrite.\");\r\n\t\t}\r\n\t\tgetters[name]=cb;\r\n\t} \r\n}\r\nvar unregisterGetter=function(name) {\r\n\tregisterGetter(name);\r\n}\r\n\r\nvar store={\r\n\tlisten:function(event,cb,element){\r\n\t\tlisteners.push([element,event,cb]);\r\n\t}\r\n\t,unlistenAll:function(element){\r\n\t\tif (!element) {\r\n\t\t\tconsole.error(\"unlistenAll should specify this\")\r\n\t\t}\r\n\t\tlisteners=listeners.filter(function(listener){\r\n\t\t\treturn (listener[0]!==element) ;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nmodule.exports={ action, store, getter, registerGetter, unregisterGetter, hasGetter};",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar CodeMirror=require(\"ksana-codemirror\").Component;\r\n\r\nvar NotePopup=React.createClass({\r\n\tgetInitialState:function(){\r\n\t\treturn {close:true};\r\n\t},\r\n\tpropTypes:{\r\n\t\trule:PT.object.isRequired,\r\n\t\tx:PT.number.isRequired,\r\n\t\ty:PT.number.isRequired,\r\n\t\ttext:PT.string.isRequired\r\n\t},\r\n\tclose:function(){\r\n\t\tthis.setState({close:true});\r\n\t},\r\n\tcomponentWillReceiveProps:function(nextProps){\r\n\t\tif (nextProps.text) this.setState({close:false});\r\n\t},\r\n\tcomponentDidUpdate:function(){\r\n\t\tvar cm=this.refs.cm;\r\n\t\tif (!cm)return;\r\n\t\tcm=cm.getCodeMirror();\r\n\t\tthis.props.rule.markLines(cm,0,cm.lineCount()-1,\r\n\t\t\t{note:true,pagebreak:true,link:true});\r\n\t},\r\n\trender:function(){\r\n\t\tif (!this.props.text||this.props.x<0 ||this.state.close){\r\n\t\t\treturn E(\"div\",{});\r\n\t\t}\r\n\t\tvar style=JSON.parse(JSON.stringify(styles.viewcontrols));\r\n\t\tstyle.left=this.props.x;\r\n\t\tstyle.top=this.props.y;\r\n\t\tstyle.height=150;\r\n\t\tstyle.width=320;\r\n\t\tif (style.left+style.width>this.props.w) {\r\n\t\t\t\tstyle.left-=style.left+style.width-this.props.w+20;\r\n\t\t} \r\n\t\tif (style.top+style.height>this.props.h) {\r\n\t\t\t\tstyle.top-=style.top+style.height-this.props.h+20;\r\n\t\t} \r\n\t\treturn\tE(\"div\",{style:styles.container},\r\n\t\t\t\tE(\"div\",{style},\r\n\t\t\t\t\tE(\"button\",{style:styles.button,onClick:this.close},\"x\"),\r\n\t\t\t\t\tE(CodeMirror,{ref:\"cm\",readOnly:true,value:this.props.text})\r\n\t\t\t\t)\r\n\t\t)\r\n\t}\r\n})\r\n\r\nvar styles={\r\n\tbutton:{position:\"absolute\",right:0,\r\n\tfontSize:20,borderRadius:\"50%\",zIndex:103,opacity:0.5},\r\n\tcontainer:{background:\"blue\",position:\"relative\",zIndex:101},\r\n\tviewcontrols:{position:\"absolute\"} //for scrollbar\r\n}\r\nmodule.exports=NotePopup;",
    "var React=require(\"react\");\r\nvar ReactDOM=require(\"react-dom\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar CodeMirror=require(\"ksana-codemirror\").Component;\r\nvar TopRightMenu=require(\"./toprightmenu\");\r\nvar NotePopup=require(\"./notepopup\");\r\nrequire(\"./loadfile\");\r\n\r\nvar TaishoView=React.createClass({\r\n\tgetInitialState:function(){\r\n\t\treturn {data:this.props.data||\"empty\"};\r\n\t}\r\n\t,contextTypes:{\r\n\t\tstore:PT.object,\r\n\t\tgetter:PT.func,\r\n\t\taction:PT.func\r\n\t}\r\n\t,componentWillReceiveProps:function(nextProps) {\r\n\t\tif (nextProps.doc!==this.props.doc) {\r\n\t\t\tthis.context.getter(\"file\",{filename:nextProps.doc,side:nextProps.side});\t\r\n\t\t}\r\n\t}\r\n\t,componentDidMount:function(){\r\n\t\tthis.defaultListeners();\r\n\t\tif (this.props.doc) {\r\n\t\t\tthis.context.getter(\"file\",{filename:this.props.doc,side:this.props.side});\r\n\t\t}\r\n\t}\r\n\t,defaultListeners:function(){\r\n\t\tthis.context.store.listen(\"loaded\",this.onLoaded,this);\r\n\t\tthis.context.store.listen(\"layout\",this.onLayout,this);\r\n\t\tthis.context.store.listen(\"toggleLineNumber\",this.onToggleLineNumber,this);\r\n\t}\r\n\t,getDocRule:function(doc){\r\n\t\tdoc=doc||this.props.doc;\r\n\t\tvar docs=this.props.docs;\r\n\t\tfor (var i=0;i<docs.length;i++) {\r\n\t\t\tif (docs[i].name==this.props.doc) {\r\n\t\t\t\treturn docs[i].rule;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t,onLayout:function(mode){\r\n\t\tvar rule=this.getDocRule();\r\n\t\tif (!rule)return;\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\t\tvar text=rule.breakline(this.data,mode||\"lb\");\r\n\t\tcm.setValue(text);\r\n\t}\r\n\t,onToggleLineNumber:function(side){\r\n\t\tif (side!==this.props.side)return;\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\t\tvar lineNumbers=cm.getOption(\"lineNumbers\");\r\n\t\tcm.setOption(\"lineNumbers\",!lineNumbers);\r\n\t}\r\n\t,onLoaded:function(res){\r\n\t\tif (res.side!==this.props.side) return;\r\n\t\tvar cm=this.refs.cm.getCodeMirror();\r\n\r\n\t\tvar rule=this.getDocRule();\r\n\t\trule.setActionHandler(this.context.action);\r\n\r\n\t\tvar text=rule.breakline(res.data,\"lb\");\r\n\t\tthis.data=res.data;\r\n\t\tcm.setValue(text);\r\n\t}\r\n\t,onCursorActivity:function(cm){\r\n\t\tvar cursor=cm.listSelections();\r\n\t\tconsole.log(cursor);\r\n\t}\r\n\t,lineNumberFormatter:function(line){\r\n\t\tvar rule=this.getDocRule();\r\n\t\tif (!rule)return line;\r\n\r\n\t\tvar start=rule.getFileStart(this.props.doc);\r\n\t\tvar pointer=rule.nextLine(start,line);\r\n\t\tvar marker=rule.formatPointer(pointer);\r\n\t\tmarker=marker.substr(3,7);\r\n\t\twhile (marker[0]==\"0\")marker=marker.substr(1);\r\n\t\treturn marker;\r\n\t}\r\n\t,render:function(){\r\n\t\tvar Menu=this.props.menu||TopRightMenu;\r\n\t\treturn E(\"div\",{},\r\n\t\t\tE(Menu,{side:this.props.side,onSetDoc:this.onSetDoc,\r\n\t\t\t\tbuttons:this.props.docs,selected:this.props.doc}),\r\n\t  \tE(CodeMirror,{ref:\"cm\",value:\"\",theme:\"ambiance\",readOnly:true\r\n\t  \t\t,lineNumbers:true\r\n\t  \t\t,lineNumberFormatter:this.lineNumberFormatter\r\n\t  \t\t,onCursorActivity:this.onCursorActivity})\r\n\t\t\t);\r\n\t}\t\r\n})\r\nmodule.exports=TaishoView;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar TocResult=React.createClass({\r\n\tgetInitialState:function(){\r\n\t\treturn {res:[]};\r\n\t},\r\n\tcomponentDidMount:function(){\r\n\t\tthis.setState({res:this.search()})\r\n\t}\r\n\t,sortByDepth:function(res){\r\n\t\tvar T=this.props.toc;\r\n\t\treturn res.sort(function(a,b){\r\n\t\t\treturn T[a].d-T[b].d;\r\n\t\t});\r\n\t}\r\n\t,sortByLength:function(res){\r\n\t\tvar T=this.props.toc;\r\n\t\treturn res.sort(function(a,b){\r\n\t\t\treturn T[a].t.length-T[b].t.length;\r\n\t\t});\r\n\t}\r\n\t,search:function(tofind,order,toc){\r\n\t\tvar res=[];\r\n\t\ttofind=tofind||this.props.tofind,\r\n\t\torder=order||this.props.order,\r\n\t\ttoc=toc||this.props.toc;\r\n\t\tvar pat=new RegExp(tofind);\r\n\t\tfor (var i=0;i<toc.length;i++) {\r\n\t\t\tvar m=toc[i].t.match(pat);\r\n\t\t\tif (m) {\r\n\t\t\t\tres.push(i);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (order===2) this.sortByDepth(res);\r\n\t\telse if (order===3) this.sortByLength(res);\r\n\t\tif (res.length>300) {\r\n\t\t\tres.length=300;\r\n\t\t\tres.push(\"only first 300 matches are shown\");\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\t,componentWillReceiveProps:function(nextProps){\r\n\t\tif (nextProps.tofind!==this.props.tofind ||nextProps.order!==this.props.order) {\r\n\t    this.setState({res:this.search(nextProps.tofind,nextProps.order)});\r\n\t\t}\r\n\t}\r\n\t,highlightText:function(text) {\r\n\t\tvar pat=new RegExp(this.props.tofind);\r\n\t\tvar out=[],lastidx=0;\r\n\t\ttext.replace(pat,function(t,key){\r\n\t\t\tout.push(text.substring(lastidx,key));\r\n\t\t\tout.push(E(\"span\",{className:\"found\",key},t));\r\n\t\t\tlastidx=key+t.length;\r\n\t\t});\r\n\t\tout.push(text.substr(lastidx));\r\n\t\treturn out;\r\n\t}\r\n\t,onSelect:function(e){\r\n\t\tvar n=parseInt(e.target.dataset.n);\r\n\t\tif (isNaN(n)) {\r\n\t\t\tn=parseInt(e.target.parentElement.dataset.n);\r\n\t\t}\r\n\t\tif (this.props.toc[n]){\r\n\t\t\tthis.props.onSelect(this,this.props.toc[n]);\t\t\t\r\n\t\t}\r\n\t}\r\n\t,renderNode:function(n,key){\r\n\t\tvar item=this.props.toc[n];\r\n\t\tif (typeof n==\"string\") {\r\n\t\t\treturn E(\"div\",{key},n);\r\n\t\t}\r\n\t\tvar hl=this.highlightText(item.t);\r\n\t\treturn E(\"div\",{className:\"foundline\",key,onClick:this.onSelect,\"data-n\":n},\r\n\t\t\tE(\"div\",{style:{fontFamily:item.f}},hl)\r\n\t\t);\r\n\t}\r\n\t,render:function(){\r\n\t\treturn E(\"div\",{},\r\n\t\t\tthis.state.res.map(this.renderNode)\r\n\t\t);\r\n\t}\r\n});\r\nmodule.exports=TocResult;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar TopRightMenu=React.createClass({\r\n\tsetDoc:function(name){\r\n\t\tthis.props.onSetDoc(this.props.side,name);\r\n\t}\r\n\t,createButton:function(item,key){\r\n\t\tvar style=styles.button;\r\n\t\tif (item.name==this.props.selected) {\r\n\t\t\tstyle=JSON.parse(JSON.stringify(styles.button));\r\n\t\t\tstyle=Object.assign(style,styles.selectedButton);\r\n\t\t}\r\n\t\treturn E(\"button\",{key,style,onClick:this.setDoc.bind(this,item.name)},item.label);\r\n\t},\r\n\trender:function(){\r\n\t\treturn\tE(\"div\",{style:styles.container},\r\n\t\t\t\tE(\"div\",{style:styles.viewcontrols},\r\n\t\t\t\t\tthis.props.buttons.map(this.createButton)\r\n\t\t\t\t)\r\n\t\t)\r\n\t}\r\n})\r\n\r\nvar styles={\r\n\tbutton:{fontSize:20,borderRadius:\"10%\"},\r\n\tselectedButton:{background:\"blue\",color:\"white\"},\r\n\tcontainer:{position:\"relative\",zIndex:100,opacity:0.7},\r\n\tviewcontrols:{position:\"absolute\",right:20,top:5} //for scrollbar\r\n}\r\nmodule.exports=TopRightMenu;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar Viewers={\r\n  default:require('./cmview'),\r\n  taisho:require(\"./taishoview\")\r\n}\r\n\r\nvar TwoColumn = React.createClass({\r\n  getInitialState:function() {\r\n    return {};\r\n  },\r\n  render:function(){\r\n    var LeftView=Viewers[this.props.leftView||\"default\"];\r\n    var RightView=Viewers[this.props.rightView||\"default\"];\r\n  \treturn E(\"div\",{style:this.props.style},\r\n  \t\tE(\"div\",{style:{display:'flex'}},\r\n  \t\t\tE(\"div\",{style:{flex:1}},\r\n  \t\t\t\tE(LeftView,{side:0,menu:this.props.leftMenu,\r\n            doc:this.props.leftDoc,docs:this.props.leftDocs})),\r\n  \t\t\tE(\"div\",{style:{flex:1}},\r\n  \t\t\t\tE(RightView,{side:1,menu:this.props.rightMenu,\r\n            doc:this.props.rightDoc,docs:this.props.rightDocs}))\r\n  \t\t)\r\n  \t)\r\n  }\r\n});\r\nmodule.exports=TwoColumn;",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar ControlPanel=require(\"./controlpanel\");\r\nvar TwoColumn=require(\"./twocolumn\");\r\n\r\n\r\nvar {action,store,getter,registerGetter,unregisterGetter}=require(\"./model\");\r\n\r\nvar modemain = React.createClass({\r\n  getInitialState:function() {\r\n    return {rightDoc:this.props.rightDoc,leftDoc:this.props.LeftDoc};\r\n  }\r\n  ,onSetDoc:function(side,filename){\r\n    if (side===0) this.setState({leftDoc:filename});\r\n    else if (side===1) this.setState({rightDoc:filename});\r\n  }\r\n  ,componentDidMount:function(){\r\n    registerGetter(\"setDoc\",this.onSetDoc);\r\n  }\r\n  ,childContextTypes: {\r\n    store: PT.object\r\n    ,action: PT.func\r\n    ,getter: PT.func\r\n    ,registerGetter:PT.func\r\n    ,unregisterGetter:PT.func\r\n  }\r\n  ,getChildContext:function(){\r\n    return {action,store,getter,registerGetter,unregisterGetter};\r\n  }  \r\n  ,render: function() {\r\n    var props1=Object.assign({},this.props);\r\n    props1.style=styles.controls;\r\n\r\n    var props2=Object.assign({},this.props);\r\n    props2.style=styles.body;\r\n    props2.rightDoc=this.state.rightDoc||props2.rightDoc;\r\n    props2.leftDoc=this.state.leftDoc||props2.leftDoc;\r\n\r\n    return E(\"div\",\r\n      {style:styles.topcontainer},\r\n      E(ControlPanel,props1),\r\n      E(TwoColumn,props2)\r\n    )\r\n  }\r\n});\r\nvar styles={\r\n  topcontainer:{display:\"flex\"},\r\n  controls:{flex:1,background:'gray',fontSize:\"75%\",\r\n  height:\"100%\",overflowY:\"scroll\",overflowX:\"hidden\"},\r\n  body:{flex:4},\r\n}\r\nmodule.exports=modemain;",
    "var React=require(\"react\");\nvar E=React.createElement;\nvar styles={\n\ttextarea:{fontSize:\"100%\"}\n}\nvar linecount=function(t) {\n\tvar lcount=0;\n\tt.replace(/\\n/g,function(){\n\t\tlcount++;\n\t})\n\treturn lcount+2;\n}\nvar AddNode=React.createClass({\n\tpropTypes:{\n\t\taction: React.PropTypes.func.isRequired\n\t}\n\t,addingkeydown:function(e) {\n\t\tvar t=e.target.value;\n\t\tif (e.key==\"Enter\" && t.charCodeAt(t.length-1)===10) {\n\t\t\tthis.props.action(\"addnode\",t.split(\"\\n\"),this.props.insertBefore);\n\t\t}\n\t\tvar lc=linecount(t);\n\t\te.target.rows=lc;\n\t}\n\t,componentDidMount:function() {\n\t\tthis.refs.adding.focus();\n\t}\n\t,render:function(){\n\t\treturn E(\"div\", {}, \n\t\t\tE(\"textarea\",\n\t\t\t\t{style:styles.textarea,onKeyDown:this.addingkeydown,ref:\"adding\"\n\t\t\t\t ,placeholder:\"leading space to create child node\",defaultValue:\"\"}\n\t\t));\n\t}\n\n})\n\nmodule.exports=AddNode;",
    "var React=require(\"react\");\nvar E=React.createElement;\n\nvar Controls=React.createClass({\n\tpropTypes:{\n\t\tenabled:React.PropTypes.array.isRequired\n\t\t,action:React.PropTypes.func.isRequired\n\t}\n\t,getDefaultProps:function(){\n\t\treturn {enabled:[]};\n\t}\n\t,enb:function(name) {\n\t\treturn this.props.enabled.indexOf(name)===-1;\t\t\n\t}\n\t,act:function(name) {\n\t\tvar that=this;\n\t\treturn function(e){\n\t\t\tthat.props.action(name,e.ctrlKey);\n\t\t}\n\t}\n\t,render:function() {\n\t\treturn E(\"span\",{},\n\t\t\tE(\"button\" ,{onClick:this.act(\"addingnode\"),title:\"Create a new node below, press Ctrl to above here.\"},\"＋\"),\n\t\t\tE(\"button\" ,{style:{visibility:\"hidden\"}},\" \"),\n\t\t\tE(\"button\" ,{onClick:this.act(\"levelup\"),title:\"level -1\",disabled:this.enb(\"levelup\")},\"⇠\"),\n\t\t\tE(\"button\" ,{onClick:this.act(\"leveldown\"),title:\"level +1\",disabled:this.enb(\"leveldown\")},\"⇢\")\n\t\t);\n\t}\n})\n\nmodule.exports=Controls;",
    "/*\n   toc data format\n   array of { d:depth, o:opened, t:text, n:next_same_level ]\n\n   only first level can be 0\n\n   TODO, do not write directly to props.toc\n*/\nvar React=require(\"react\");\nvar TreeNode=require(\"./treenode\");\nvar E=React.createElement;\nvar manipulate=require(\"./manipulate\");\n\nvar buildToc = function(toc) {\n\tif (!toc || !toc.length || toc.built) return;\n\tvar depths=[];\n \tvar prev=0;\n \tif (toc.length>1) {\n \t\ttoc[0].o=true;//opened\n \t}\n \tfor (var i=0;i<toc.length;i++) delete toc[i].n;\n\tfor (var i=0;i<toc.length;i++) {\n\t    var depth=toc[i].d||toc[i].depth;\n\t    if (prev>depth) { //link to prev sibling\n\t      if (depths[depth]) toc[depths[depth]].n = i;\n\t      for (var j=depth;j<prev;j++) depths[j]=0;\n\t    }\n    \tdepths[depth]=i;\n    \tprev=depth;\n\t}\n\ttoc.built=true;\n\treturn toc;\n}\nvar genToc=function(toc,title) {\n    var out=[{d:0,t:title||ksana.js.title}];\n    if (toc.texts) for (var i=0;i<toc.texts.length;i++) {\n      out.push({t:toc.texts[i],d:toc.depths[i], vpos:toc.vpos[i]});\n    }\n    return out;\n}\n\nvar TreeToc=React.createClass({\n\tpropTypes:{\n\t\ttoc:React.PropTypes.array.isRequired  //core toc dataset\n\t\t,opts:React.PropTypes.object    \n\t\t,onSelect:React.PropTypes.func  //user select a treenode\n\t\t,tocid:React.PropTypes.string  //toc view \n\t\t,styles:React.PropTypes.object //custom styles\n\t\t,conv:React.PropTypes.func //custom converter for each item\n\t}\n\t,getInitialState:function(){\n\t\treturn {editcaption:-1,selected:[]};\n\t}\n\t,clearHits:function() {\n\t\tfor (var i=0;i<this.props.toc.length;i++) {\n\t\t\tif (this.props.toc[i].hit) delete this.props.toc[i].hit;\n\t\t}\n\t}\n\t,componentDidMount:function() {\n\t\tbuildToc(this.props.toc);\n\t}\n\t,componentWillReceiveProps:function(nextProps) {\n\t\tif (nextProps.toc && !nextProps.toc.built) {\n\t\t\tbuildToc(nextProps.toc);\n\t\t}\n\t\tif (nextProps.hits!==this.props.hits) {\n\t\t\tthis.clearHits();\n\t\t}\n\t\tthis.action(\"updateall\");\n\t}\n\t,getDefaultProps:function() {\n\t\treturn {opts:{}};\n\t}\n\t,markDirty:function() {\n\t\tthis.props.onChanged&&this.props.onChanged();\n\t}\n\t,action:function() {\n\t\tvar args=Array.prototype.slice.apply(arguments);\n\t\tvar act=args.shift();\n\t\tvar p1=args[0];\n\t\tvar p2=args[1];\n\t\tvar sels=this.state.selected;\n\t\tvar toc=this.props.toc;\n\t\tvar r=false;\n\t\tif (act===\"updateall\") {\n\t\t\tthis.setState({editcaption:-1,deleting:-1});\n\t\t} else if (act===\"editcaption\") {\n\t\t\tvar n=parseInt(p1);\n\t\t\tthis.setState({editcaption:n,selected:[n]});\n\t\t} else if (act===\"deleting\") {\n\t\t\tthis.setState({deleting:this.state.editcaption});\n\t\t} else if (act===\"changecaption\") {\n\t\t\tif (!this.state.editcaption===-1) return;\n\t\t\tif (!p1) {\n\t\t\t\tthis.action(\"deleting\");\n\t\t\t} else {\n\t\t\t\tthis.props.toc[this.state.editcaption].t=p1;\n\t\t\t\tthis.setState({editcaption:-1});\n\t\t\t\tthis.markDirty();\n\t\t\t}\n\t\t} else if (act===\"select\") {\n\t\t\tvar selected=this.state.selected;\n\t\t\tif (!(this.props.opts.multiselect && p2)) {\n\t\t\t\tselected=[];\n\t\t\t}\n\t\t\tvar n=parseInt(p1);\n\t\t\tif (!isNaN(n)) {\n\t\t\t\tselected.push(n);\n\t\t\t\tthis.props.onSelect&&this.props.onSelect(this.props.tocid,this.props.toc[n],n,this.props.toc);\n\t\t\t}\n\t\t\tthis.setState({selected:selected,editcaption:-1,deleting:-1,adding:0});\n\t\t} else if (act===\"addingnode\") {\n\t\t\tvar insertAt=sels[0];\n\t\t\tif (p1) {\n\t\t\t\tinsertAt=-insertAt; //ctrl pressed insert before\n\t\t\t}\n\t\t\tthis.setState({adding:insertAt,editcaption:-1});\n\t\t} else if (act==\"addnode\") {\n\t\t\tvar n=this.state.selected[0];\n\t\t\tr=manipulate.addNode(toc,n,p1,p2)\n\t\t}else if (act===\"levelup\") r=manipulate.levelUp(sels,toc);\n\t\telse if (act===\"leveldown\") r=manipulate.levelDown(sels,toc);\n\t\telse if (act===\"deletenode\") r=manipulate.deleteNode(sels,toc);\n\t\telse if (act===\"hitclick\") {\n\t\t\tthis.props.onHitClick&&this.props.onHitClick(this.props.tocid,this.props.toc[p1],p1,this.props.toc);\n\t\t}\n\t\tif (r) {\n\t\t\ttoc.built=false;//force rebuild\n\t\t\tbuildToc(toc);\n\t\t\tthis.setState({editcaption:-1,deleting:-1,adding:0});\n\t\t\tif (act===\"deletenode\") this.setState({selected:[]});\n\t\t\tthis.markDirty();\n\t\t}\n\t}\n\t,render:function() {\n\t\treturn E(\"div\",{},\n\t\t\tE(TreeNode,{toc:this.props.toc,\n\t\t\t\teditcaption:this.state.editcaption,\n\t\t\t\tdeleting:this.state.deleting,\n\t\t\t\tselected:this.state.selected,\n\t\t\t\ttreename:this.props.treename,\n\t\t\t\tstyles:this.props.styles,\n\t\t\t\tadding:this.state.adding,\n\t\t\t\topened:this.props.opened,\n\t\t\t\tclosed:this.props.closed,\n\t\t\t\tcaptionClass:this.props.captionClass,\n\t\t\t\tnodeicons:this.props.nodeicons,\n\t\t\t\taction:this.action,opts:this.props.opts,cur:0,\n\t\t\t\thits:this.props.hits,\n\t\t\t\tconv:this.props.conv\n\t\t\t}));\n\t}\n})\nmodule.exports={Component:TreeToc,genToc:genToc,buildToc:buildToc};\n",
    "var descendantOf=function(n,toc) { /* returning all descendants */\n\tvar d=toc[n].d;\n\tn++;\n\twhile (n<toc.length) {\n\t\tif (toc[n].d<=d) return n;\n\t\tn++;\n\t}\n\treturn toc.length-1;\n}\nvar levelUp =function(sels,toc) { //move select node and descendants one level up\n\tif (!canLevelup(sels,toc))return;\n\tvar n=sels[0];\n\tvar cur=toc[n];\n\tvar next=toc[n+1];\n\tvar nextsib=cur.n||descendantOf(n,toc);\n\tif (next && next.d>cur.d) { //has child\n\t\tfor (var i=n+1;i<nextsib;i++) {\n\t\t\ttoc[i].d--;\n\t\t}\n\t}\n\tcur.d--;\n\tcur.o=true;//force open this node , so that sibling is visible\n\treturn true;\n}\nvar levelDown =function(sels,toc) {\n\tif (!canLeveldown(sels,toc))return; //move select node descendants one level down\n\tvar n=sels[0];\n\tvar cur=toc[n];\n\tvar next=toc[n+1];\n\n\t//force open previous node as it becomes parent of this node\n\tvar p=prevSibling(n,toc);\n\tif (p) toc[p].o=true;\n\n\tif (!cur.o) { //do no move descendants if opened\n\t\tif (next && next.d>cur.d) { //has child\n\t\t\tfor (var i=n+1;i<cur.n;i++) {\n\t\t\t\ttoc[i].d++;\n\t\t\t}\n\t\t}\t\t\n\t}\n\tcur.d++;\n\treturn true;\n}\nvar parseDepth=function(s,basedepth,dnow) {\n\tvar d=0;\n\t\n\twhile (s[0]===\" \") {\n\t\ts=s.substr(1);\n\t\td++;\n\t}\n\tif (basedepth+d>dnow+1) d=dnow+1-basedepth;\n\n\treturn {d:basedepth+d,t:s.trim()};\n}\nvar addNode =function(toc,n,newnodes,insertbefore) {\n\tvar d=toc[n].d, basedepth=d, dnow=d;\n\tif (!insertbefore) {\n\t\t//toc[n].o=true;\n\t\tif (toc[n].n)\tn=toc[n].n ;\n\t\telse (n++);\n\t}\n\t\n\n\tvar args=[n,0];\n\n\tfor (var i=0;i<newnodes.length;i++) {\n\t\tvar r=parseDepth(newnodes[i],basedepth,dnow);\n\t\tif (r.t) {\n\t\t\targs.push(r);\n\t\t\tdnow=r.d;\n\t\t}\n\t}\n\ttoc.splice.apply(toc,args);\n\treturn true;\n}\nvar deleteNode =function(sels,toc) {\n\tif (!canDeleteNode(sels,toc))return; //move select node descendants one level down\n\tvar n=sels[0];\n\tvar to=descendantOf(n,toc);\n\tvar del=to-n;\n\tif (n==toc.length-1) del++;\n\ttoc.splice(n,del);\n\treturn true;\n}\n\nvar canDeleteNode=function(sels,toc) {\n\tif (sels.length==0) return false;\n\tvar n=sels[0];\n\treturn (sels.length==1 && toc[n].d>0 && toc.length>2);\n}\nvar canLevelup=function(sels,toc) {\n\tif (sels.length==0) return false;\n\tvar n=sels[0];\n\treturn (sels.length==1 && toc[n].d>1);\n}\nvar prevSibling=function(n,toc) {\n\tvar p=n-1;\n\tvar d=toc[n].d;\n\twhile (p>0) {\n\t\tif (toc[p].d<d) return 0;\n\t\tif (toc[p].d==d) return p;\n\t\tp--;\n\t}\n}\nvar canLeveldown=function(sels,toc) {\n\tif (sels.length==0) return false;\n\tvar n=sels[0];\n\treturn (sels.length==1 && prevSibling(n,toc));\n}\nvar enabled=function(sels,toc) {\n\tvar enabled=[];\n\tif (canLeveldown(sels,toc)) enabled.push(\"leveldown\");\n\tif (canLevelup(sels,toc)) enabled.push(\"levelup\");\n\tif (canDeleteNode(sels,toc)) enabled.push(\"deletenode\");\n\treturn enabled;\n}\nmodule.exports={enabled:enabled,levelUp:levelUp,levelDown:levelDown,\n\taddNode:addNode,deleteNode:deleteNode,descendantOf:descendantOf};",
    "var React=require(\"react\");\nvar E=React.createElement;\n\nvar manipulate=require(\"./manipulate\");\nvar Controls=require(\"./controls\");\nvar AddNode=require(\"./addnode\");\nvar treenodehits=null;\n\ntry {\n\ttreenodehits=require(\"ksana-simple-api\").treenodehits;\n} catch(e) {\n\t//don't have ksana libray\n\ttreenodehits=function(){return 0};\n}\n\nvar defaultstyles={\n\tselectedcaption:{borderBottom:\"1px solid blue\",cursor:\"pointer\",borderRadius:\"5px\"}\n\t,caption:{cursor:\"pointer\"}\n\t,childnode:{left:\"0.7em\",position:\"relative\"}\n\t,rootnode:{position:\"relative\"}\n\t,folderbutton: {cursor:\"pointer\",borderRadius:\"50%\"}\n\t,closed:{cursor:\"pointer\",fontSize:\"75%\"}\n\t,opened:{cursor:\"pointer\",fontSize:\"75%\"}\t\n\t,leaf:{fontSize:\"75%\"}\t\n\t,hiddenleaf:{visibility:\"hidden\"}\t\n\t,deletebutton:{background:\"red\",color:\"yellow\"}\n\t,nodelink:{fontSize:\"65%\",cursor:\"pointer\"}\n\t,hit:{color:\"red\",fontSize:\"65%\",cursor:\"pointer\"}\n\t,input:{fontSize:\"100%\"}\t\n};\nvar styles={};\n\nvar TreeNode=React.createClass({\n\tpropTypes:{\n\t\ttoc:React.PropTypes.array.isRequired\n\t\t,opts:React.PropTypes.object\n\t\t,action:React.PropTypes.func.isRequired \n\t\t,selected:React.PropTypes.array         //selected treenode (multiple)\n\t\t,cur:React.PropTypes.number.isRequired //current active treenode\n\t\t,styles:React.PropTypes.object  //custom style\n\t\t,nodeicons:React.PropTypes.node\n\t}\n\t,getDefaultProps:function() {\n\t\treturn {cur:0,opts:{},toc:[]};\n\t}\n\t,componentWillMount:function(){\n\t\tthis.cloneStyle();\n\t}\n\t,click:function(e) {\n\t\tele=e.target;\n\t\twhile (ele && !ele.attributes['data-n']) {\n\t\t\tele=ele.parentElement;\n\t\t}\n\t\tvar n=parseInt(ele.attributes['data-n'].value);\n\t\tthis.props.toc[n].o=!this.props.toc[n].o;\n\t\tthis.forceUpdate();\n\t\te.preventDefault();\n    e.stopPropagation();\n\t}\n\t,select:function(e){\n\t\tif (e.target.nodeName!==\"SPAN\") return;\n\t\tvar datan=e.target.parentElement.attributes['data-n'];\n\t\tif (!datan) return;\n\t\tvar n=parseInt(datan.value);\n\t\tvar selected=this.props.selected.indexOf(n)>-1;\n\t\tif (selected) {\n\t\t\tif (this.props.opts.editable)  {\n\t\t\t\tthis.props.action(\"editcaption\",n);\t\n\t\t\t} else {\n\t\t\t\t//toggle folder button\n\t\t\t\tthis.click(e);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.props.action(\"select\",n,e.ctrlKey);\n\t\t}\n\t\te.preventDefault();\n    e.stopPropagation();\n\t}\n\t,cloneStyle:function(newstyles) {\n\t\tstyles={};\n\t\tfor (var i in defaultstyles) styles[i]=defaultstyles[i];\n\t\tif (newstyles) for (var i in newstyles) styles[i]=newstyles[i];\n\t}\n\n\t,componentWillReceiveProps:function(nextProps) {\n\t\tif (nextProps.styles && nextProps.styles!==this.props.styles) this.cloneStyle(nextProps.styles)\n\t}\n\t,componentDidUpdate:function() {\n\t\tif (this.refs.editcaption) {\n\t\t\tvar dom=this.refs.editcaption;\n\t\t\tdom.focus();\n\t\t\tdom.selectionStart=dom.value.length;\n\t\t}\n\t}\n\t,oninput:function(e) {\n\t\tvar size=e.target.value.length+2;;\n\t\tif (size<5) size=5;\n\t\te.target.size=size;\n\t}\n\n\t,editingkeydown:function(e) {\n\t\tif (e.key==\"Enter\") {\n\t\t\tthis.props.action(\"changecaption\",e.target.value);\t\n\t\t\te.stopPropagation();\n\t\t} else this.oninput(e);\n\t}\n\t,deleteNodes:function() {\n\t\tthis.props.action(\"deletenode\");\n\t}\n\t,renderDeleteButton:function(n) {\n\t\tvar childnode=null;\n\t\tvar children=manipulate.descendantOf(n,this.props.toc);\n\t\tif (children>n+1) childnode=E(\"span\",{},\" \"+(children-n)+\" nodes\");\n\t\tvar out=E(\"button\",{onClick:this.deleteNodes,style:styles.deletebutton},\"Delete\",childnode);\n\t\treturn out;\n\t}\n\t,mouseenter:function(e) {\n\t\t//e.target.style.background=\"highlight\";\n\t\te.target.style.oldcolor=e.target.style.color;\n\t\t//e.target.style.color=\"HighlightText\";\n\t\te.target.style.borderRadius=\"5px\";\n\t\tthis.lasttarget=e.target;\n\t}\n\t,mouseleave:function(e) {\n\t\tif (!this.lasttarget)return;\n\t\t//this.lasttarget.style.background=\"none\";\n\t\tthis.lasttarget.style.color=this.lasttarget.style.oldcolor;\n\t}\n\t,renderFolderButton:function(n) {\n\t\tvar next=this.props.toc[n+1];\n\t\tvar cur=this.props.toc[n];\n\t\tvar folderbutton=null;\n\t\tvar props={style:styles.closed, onClick:this.click, onMouseEnter:this.mouseenter,onMouseLeave:this.mouseleave};\n\t\tif (cur.o) props.style=styles.opened;\n\t\tif (next && next.d>cur.d && cur.d) { \n\t\t\tif (cur.o) folderbutton=E(\"a\",props,this.props.opened||\"－\");//\"▼\"\n\t\t\telse       folderbutton=E(\"a\",props,this.props.closed||\"＋\");//\"▷\"\n\t\t} else {\n\t\t\tfolderbutton=E(\"a\",{ style:styles.hiddenleaf},\"＊\");\n\t\t}\n\t\treturn folderbutton;\n\t}\n\t,renderCaption:function(n,depth) {\n\t\tvar cur=this.props.toc[n];\n\t\tvar stylename=\"caption\";\n\t\tvar defaultCaption=\"\";\n\t\tvar t=cur.t;\n\t\tif (this.props.conv) t=this.props.conv(t)||t;\n\t\tif (n==0) defaultCaption=this.props.treename;\n\n\t\tif (this.props.selected.indexOf(n)>-1) stylename=\"selectedcaption\";\n\t\tvar caption=null;\n\t\tif (this.props.deleting===n) {\n\t\t\tcaption=this.renderDeleteButton(n);\n\t\t} else if (this.props.editcaption===n) {\n\t\t\tvar size=cur.t.length+2;\n\t\t\tif (size<5) size=5;\n\t\t\tcaption=E(\"input\",{onKeyDown:this.editingkeydown,style:styles.input,\n\t\t\t\t               size:size,ref:\"editcaption\",defaultValue:t});\n\t\t} else {\n\t\t\tif (t.length<5) t=t+\"  \";\n\t\t\tvar style=JSON.parse(JSON.stringify(styles[stylename]));\n\n\t\t\tif (this.props.nodeicons) {\n\t\t\t\tvar nodeicon=getNodeIcon(depth,this.props.nodeicons);\n\t\t\t\tif (typeof nodeicon==\"string\") style.backgroundImage=\"url(\"+nodeicon+\")\";\n\t\t\t\tstyle.backgroundRepeat=\"no-repeat\";\n\t\t\t}\n\n\t\t\tcaption=E(\"span\",{onMouseEnter:this.mouseenter,onMouseLeave:this.mouseleave,\n\t\t\t\tclassName:this.props.captionClass,style:style,title:n},(defaultCaption||t)+(cur.o?\" \":\"\"));\n\t\t\t//force caption to repaint by appending extra space at the end\n\t\t}\n\t\treturn caption;\n\t}\n\t,renderAddingNode:function(n,above) {\n\t\tif (this.props.adding===n && n) { \n\t\t\treturn E(AddNode,{insertBefore:above,action:this.props.action});\n\t\t}\n\t}\n\t,renderEditControls:function(n) {\n\t\tif (!this.props.opts.editable) return;\n\t\tif (this.props.editcaption===n && n>0) {\t\n\t\t\tvar enabled=manipulate.enabled([n],this.props.toc);\n\t\t\treturn E(Controls,{action:this.props.action,enabled:enabled});\n\t\t} \n\t}\n\t,renderItem:function(e,idx){\n\t\tvar t=this.props.toc[e];\n\t\tvar props={};\n\t\tfor (var i in this.props) {\n\t\t\tprops[i]=this.props[i];\n\t\t}\n\t\tvar opened=t.o?\"o\":\"\";\n\t\tprops.key=\"k\"+e;\n\t\tprops.cur=e;\n\t\treturn E(TreeNode,props);\n\t}\n\t,clickhit:function(e) {\n\t\tvar n=parseInt(e.target.dataset.n);\n\t\tthis.props.action(\"hitclick\",n);\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t}\n\t,renderHit:function(hit,n) {\n\t\tif (!hit) return;\n\t\treturn E(\"span\",{onClick:this.clickhit,style:styles.hit,\"data-n\":n,className:\"treenode_hit\",\n\t\t\tonMouseEnter:this.mouseenter,onMouseLeave:this.mouseleave},hit);\n\t}\n\t,render:function() {\n\t\tif (this.props.toc.length===0) return E(\"span\",{},\"\");\n\t\tvar n=this.props.cur;\n\t\tvar cur=this.props.toc[n];\n\t\tvar stylename=\"childnode\",children=[];\n\t\tvar selected=this.props.selected.indexOf(n)>-1;\n\t\tvar nodeicon=\"\";\n\t\tif (this.props.nodeicons&&typeof this.props.nodeicons[0]!==\"string\"){\n\t\t\tvar nodeicon=getNodeIcon(cur.d,this.props.nodeicons);\t\n\t\t}\n\t\t\n\t\tvar depthdeco=renderDepth(cur.d,this.props.opts)\n\t\tif (cur.d==0) stylename=\"rootnode\";\n\t\tvar adding_before_controls=this.renderAddingNode(-n,true);\n\t\tvar adding_after_controls=this.renderAddingNode(n);\n\t\tvar editcontrols=this.renderEditControls(n);\n\t\tvar folderbutton=this.renderFolderButton(n);\n\t\tvar caption=this.renderCaption(n,cur.d);\n\n\t\tif (cur.o) children=enumChildren(this.props.toc,n);\n\n\t\tvar extracomponent=this.props.opts.onNode&& this.props.opts.onNode(cur,selected,n,this.props.editcaption);\n\t\tif (this.props.deleting>-1) extracomponent=null;\n\t\tif (this.props.deleting>-1) editcontrols=null;\n\t\tvar hitcount=treenodehits(this.props.toc,this.props.hits,n);\n\t\tvar s=styles[stylename];\n\t\tif (this.props.opts.rainbow&& stylename==\"childnode\") {\n\t\t\ts=JSON.parse(JSON.stringify(styles[stylename]));\n\t\t\ts.left=\"\";//no ident\n\t\t\tvar angle=(cur.d+1)*30;\n\t\t\tif (cur.f) {\n\t\t\t\ts.fontFamily=cur.f;\n\t\t\t} else {\n\t\t\t\ts.fontFamily=this.props.opts.font||\"system\";\n\t\t\t}\n\t\t\ts.background=\"hsl(\"+angle+\",40%,50%)\";\n\t\t}\n\n\t\treturn E(\"div\",{onClick:this.select,\"data-n\":n,style:s,className:\"treenode_lv\"+cur.d},\n\n\t\t\t   adding_before_controls,\n\t\t\t   folderbutton,nodeicon,depthdeco,\n\t\t\t   editcontrols,\n\t\t\t   caption,\n\t\t\t   this.renderHit(hitcount,n),\n\t\t\t   extracomponent,\n\t\t\t   adding_after_controls,\n\t\t\t   children.map(this.renderItem));\n\t}\n});\n\nvar getNodeIcon=function(depth,nodeicons) {\n\tif (!nodeicons) return;\n\tif (!nodeicons[depth]) return nodeicons[nodeicons.length-1];//return last icon\n\treturn nodeicons[depth];\n}\nvar ganzhi=\"　甲乙丙丁戊己庚辛壬癸子丑寅卯辰巳午未申酉戌亥\";\n\nvar renderDepth=function(depth,opts) {\n  var out=[];\n  if (opts&&opts.tocstyle==\"ganzhi\") {\n    return E(\"span\", null, ganzhi[depth].trim()+\" \");\n  } else {\n    if (opts&&opts.numberDepth && depth) return E(\"span\", null, depth, \".\")\n    else return null;\n  }\n  return null;\n};\n\n\nvar enumChildren=function(toc,cur) {\n    var children=[];\n    if (!toc || !toc.length || toc.length==1) return children;\n    thisdepth=toc[cur].d||toc[cur].depth;\n    if (cur==0) thisdepth=0;\n    if (cur+1>=toc.length) return children;\n    if ((toc[cur+1].d||toc[cur+1].depth)!= 1+thisdepth) {\n    \treturn children;  // no children node\n    }\n    var n=cur+1;\n    var child=toc[n];\n    \n    while (child) {\n      children.push(n);\n      var next=toc[n+1];\n      if (!next) break;\n      if ((next.d||next.depth)==(child.d||child.depth)) {\n        n++;\n      } else if ((next.d||next.depth)>(child.d||child.depth)) {\n        n=child.n||child.next;\n      } else break;\n      if (n) child=toc[n];else break;\n    }\n    return children;\n}\nmodule.exports=TreeNode;",
    "\r\nvar userCancel=false;\r\nvar files=[];\r\nvar totalDownloadByte=0;\r\nvar targetPath=\"\";\r\nvar tempPath=\"\";\r\nvar nfile=0;\r\nvar baseurl=\"\";\r\nvar result=\"\";\r\nvar downloading=false;\r\nvar startDownload=function(dbid,_baseurl,_files) { //return download id\r\n\tvar fs     = require(\"fs\");\r\n\tvar path   = require(\"path\");\r\n\r\n\t\r\n\tfiles=_files.split(\"\\uffff\");\r\n\tif (downloading) return false; //only one session\r\n\tuserCancel=false;\r\n\ttotalDownloadByte=0;\r\n\tnextFile();\r\n\tdownloading=true;\r\n\tbaseurl=_baseurl;\r\n\tif (baseurl[baseurl.length-1]!='/')baseurl+='/';\r\n\ttargetPath=ksanagap.rootPath+dbid+'/';\r\n\ttempPath=ksanagap.rootPath+\".tmp/\";\r\n\tresult=\"\";\r\n\treturn true;\r\n}\r\n\r\nvar nextFile=function() {\r\n\tsetTimeout(function(){\r\n\t\tif (nfile==files.length) {\r\n\t\t\tnfile++;\r\n\t\t\tendDownload();\r\n\t\t} else {\r\n\t\t\tdownloadFile(nfile++);\t\r\n\t\t}\r\n\t},100);\r\n}\r\n\r\nvar downloadFile=function(nfile) {\r\n\tvar url=baseurl+files[nfile];\r\n\tvar tmpfilename=tempPath+files[nfile];\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\tvar fs     = require(\"fs\");\r\n\tvar http   = require(\"http\");\r\n\r\n\tmkdirp.sync(path.dirname(tmpfilename));\r\n\tvar writeStream = fs.createWriteStream(tmpfilename);\r\n\tvar datalength=0;\r\n\tvar request = http.get(url, function(response) {\r\n\t\tresponse.on('data',function(chunk){\r\n\t\t\twriteStream.write(chunk);\r\n\t\t\ttotalDownloadByte+=chunk.length;\r\n\t\t\tif (userCancel) {\r\n\t\t\t\twriteStream.end();\r\n\t\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t\t}\r\n\t\t});\r\n\t\tresponse.on(\"end\",function() {\r\n\t\t\twriteStream.end();\r\n\t\t\tsetTimeout(function(){nextFile();},100);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nvar cancelDownload=function() {\r\n\tuserCancel=true;\r\n\tendDownload();\r\n}\r\nvar verify=function() {\r\n\treturn true;\r\n}\r\nvar endDownload=function() {\r\n\tnfile=files.length+1;//stop\r\n\tresult=\"cancelled\";\r\n\tdownloading=false;\r\n\tif (userCancel) return;\r\n\tvar fs     = require(\"fs\");\r\n\tvar mkdirp = require(\"./mkdirp\");\r\n\r\n\tfor (var i=0;i<files.length;i++) {\r\n\t\tvar targetfilename=targetPath+files[i];\r\n\t\tvar tmpfilename   =tempPath+files[i];\r\n\t\tmkdirp.sync(path.dirname(targetfilename));\r\n\t\tfs.renameSync(tmpfilename,targetfilename);\r\n\t}\r\n\tif (verify()) {\r\n\t\tresult=\"success\";\r\n\t} else {\r\n\t\tresult=\"error\";\r\n\t}\r\n}\r\n\r\nvar downloadedByte=function() {\r\n\treturn totalDownloadByte;\r\n}\r\nvar doneDownload=function() {\r\n\tif (nfile>files.length) return result;\r\n\telse return \"\";\r\n}\r\nvar downloadingFile=function() {\r\n\treturn nfile-1;\r\n}\r\n\r\nvar downloader={startDownload:startDownload, downloadedByte:downloadedByte,\r\n\tdownloadingFile:downloadingFile, cancelDownload:cancelDownload,doneDownload:doneDownload};\r\nmodule.exports=downloader;",
    "/* emulate filesystem on html5 browser */\r\nvar get_head=function(url,field,cb){\r\n\tvar xhr = new XMLHttpRequest();\r\n\txhr.open(\"HEAD\", url, true);\r\n\txhr.onreadystatechange = function() {\r\n\t\t\tif (this.readyState == this.DONE) {\r\n\t\t\t\tcb(xhr.getResponseHeader(field));\r\n\t\t\t} else {\r\n\t\t\t\tif (this.status!==200&&this.status!==206) {\r\n\t\t\t\t\tcb(\"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t};\r\n\txhr.send();\r\n}\r\nvar get_date=function(url,cb) {\r\n\tget_head(url,\"Last-Modified\",function(value){\r\n\t\tcb(value);\r\n\t});\r\n}\r\nvar get_size=function(url, cb) {\r\n\tget_head(url,\"Content-Length\",function(value){\r\n\t\tcb(parseInt(value));\r\n\t});\r\n};\r\nvar checkUpdate=function(url,fn,cb) {\r\n\tif (!url) {\r\n\t\tcb(false);\r\n\t\treturn;\r\n\t}\r\n\tget_date(url,function(d){\r\n\t\tAPI.fs.root.getFile(fn, {create: false, exclusive: false}, function(fileEntry) {\r\n\t\t\tfileEntry.getMetadata(function(metadata){\r\n\t\t\t\tvar localDate=Date.parse(metadata.modificationTime);\r\n\t\t\t\tvar urlDate=Date.parse(d);\r\n\t\t\t\tcb(urlDate>localDate);\r\n\t\t\t});\r\n\t\t},function(){\r\n\t\t\tcb(false);\r\n\t\t});\r\n\t});\r\n}\r\nvar download=function(url,fn,cb,statuscb,context) {\r\n\t var totalsize=0,batches=null,written=0;\r\n\t var fileEntry=0, fileWriter=0;\r\n\t var createBatches=function(size) {\r\n\t\tvar bytes=1024*1024, out=[];\r\n\t\tvar b=Math.floor(size / bytes);\r\n\t\tvar last=size %bytes;\r\n\t\tfor (var i=0;i<=b;i++) {\r\n\t\t\tout.push(i*bytes);\r\n\t\t}\r\n\t\tout.push(b*bytes+last);\r\n\t\treturn out;\r\n\t }\r\n\t var finish=function() {\r\n\t\t rm(fn,function(){\r\n\t\t\t\tfileEntry.moveTo(fileEntry.filesystem.root, fn,function(){\r\n\t\t\t\t\tsetTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t},function(e){\r\n\t\t\t\t\tconsole.log(\"failed\",e)\r\n\t\t\t\t});\r\n\t\t },this);\r\n\t };\r\n\t\tvar tempfn=\"temp.kdb\";\r\n\t\tvar batch=function(b) {\r\n\t\tvar abort=false;\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t\tvar requesturl=url+\"?\"+Math.random();\r\n\t\txhr.open('get', requesturl, true);\r\n\t\txhr.setRequestHeader('Range', 'bytes='+batches[b]+'-'+(batches[b+1]-1));\r\n\t\txhr.responseType = 'blob';\r\n\t\txhr.addEventListener('load', function() {\r\n\t\t\tvar blob=this.response;\r\n\t\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\t\tfileWriter.seek(fileWriter.length);\r\n\t\t\t\tfileWriter.write(blob);\r\n\t\t\t\twritten+=blob.size;\r\n\t\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\t\tif (statuscb) {\r\n\t\t\t\t\t\tabort=statuscb.apply(context,[ fileWriter.length / totalsize,totalsize ]);\r\n\t\t\t\t\t\tif (abort) setTimeout( cb.bind(context,false) , 0) ;\r\n\t\t\t\t \t}\r\n\t\t\t\t\tb++;\r\n\t\t\t\t\tif (!abort) {\r\n\t\t\t\t\t\tif (b<batches.length-1) setTimeout(batch.bind(context,b),0);\r\n\t\t\t\t\t\telse                    finish();\r\n\t\t\t\t \t}\r\n\t\t\t \t};\r\n\t\t\t}, console.error);\r\n\t\t},false);\r\n\t\txhr.send();\r\n\t}\r\n\r\n\tget_size(url,function(size){\r\n\t\ttotalsize=size;\r\n\t\tif (!size) {\r\n\t\t\tif (cb) cb.apply(context,[false]);\r\n\t\t} else {//ready to download\r\n\t\t\trm(tempfn,function(){\r\n\t\t\t\t batches=createBatches(size);\r\n\t\t\t\t if (statuscb) statuscb.apply(context,[ 0, totalsize ]);\r\n\t\t\t\t API.fs.root.getFile(tempfn, {create: 1, exclusive: false}, function(_fileEntry) {\r\n\t\t\t\t\t\t\tfileEntry=_fileEntry;\r\n\t\t\t\t\t\tbatch(0);\r\n\t\t\t\t });\r\n\t\t\t},this);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nvar readFile=function(filename,cb,context) {\r\n\tAPI.fs.root.getFile(filename, {create: false, exclusive: false},function(fileEntry) {\r\n\t\tfileEntry.file(function(file){\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onloadend = function(e) {\r\n\t\t\t\tif (cb) cb.call(cb,this.result);\r\n\t\t\t};\r\n\t\t\treader.readAsText(file,\"utf8\");\r\n\t\t});\r\n\t}, console.error);\r\n}\r\n\r\nfunction createDir(rootDirEntry, folders,  cb) {\r\n  // Throw out './' or '/' and move on to prevent something like '/foo/.//bar'.\r\n  if (folders[0] == '.' || folders[0] == '') {\r\n    folders = folders.slice(1);\r\n  }\r\n  rootDirEntry.getDirectory(folders[0], {create: true}, function(dirEntry) {\r\n    // Recursively add the new subfolder (if we still have another to create).\r\n    if (folders.length) {\r\n      createDir(dirEntry, folders.slice(1),cb);\r\n    } else {\r\n\t\t\tcb();\r\n\t\t}\r\n  }, cb);\r\n};\r\n\r\n\r\nvar writeFile=function(filename,buf,cb,context){\r\n\tvar write=function(fileEntry){\r\n\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\tfileWriter.write(buf);\r\n\t\t\tfileWriter.onwriteend = function(e) {\r\n\t\t\t\tif (cb) cb.apply(cb,[buf.byteLength]);\r\n\t\t\t};\r\n\t\t}, console.error);\r\n\t}\r\n\r\n\tvar getFile=function(filename){\r\n\t\tAPI.fs.root.getFile(filename, {exclusive:true}, function(fileEntry) {\r\n\t\t\twrite(fileEntry);\r\n\t\t}, function(){\r\n\t\t\t\tAPI.fs.root.getFile(filename, {create:true,exclusive:true}, function(fileEntry) {\r\n\t\t\t\t\twrite(fileEntry);\r\n\t\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n\tvar slash=filename.lastIndexOf(\"/\");\r\n\tif (slash>-1) {\r\n\t\tcreateDir(API.fs.root, filename.substr(0,slash).split(\"/\"),function(){\r\n\t\t\tgetFile(filename);\r\n\t\t});\r\n\t} else {\r\n\t\tgetFile(filename);\r\n\t}\r\n}\r\n\r\nvar readdir=function(cb,context) {\r\n\tvar dirReader = API.fs.root.createReader();\r\n\tvar out=[],that=this;\r\n\tdirReader.readEntries(function(entries) {\r\n\t\tif (entries.length) {\r\n\t\t\tfor (var i = 0, entry; entry = entries[i]; ++i) {\r\n\t\t\t\tif (entry.isFile) {\r\n\t\t\t\t\tout.push([entry.name,entry.toURL ? entry.toURL() : entry.toURI()]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tAPI.files=out;\r\n\t\tif (cb) cb.apply(context,[out]);\r\n\t}, function(){\r\n\t\tif (cb) cb.apply(context,[null]);\r\n\t});\r\n}\r\nvar getFileURL=function(filename) {\r\n\tif (!API.files ) return null;\r\n\tvar file= API.files.filter(function(f){return f[0]==filename});\r\n\tif (file.length) return file[0][1];\r\n}\r\nvar rm=function(filename,cb,context) {\r\n\tvar url=getFileURL(filename);\r\n\tif (url) rmURL(url,cb,context);\r\n\telse if (cb) cb.apply(context,[false]);\r\n}\r\n\r\nvar rmURL=function(filename,cb,context) {\r\n\twebkitResolveLocalFileSystemURL(filename, function(fileEntry) {\r\n\t\tfileEntry.remove(function() {\r\n\t\t\tif (cb) cb.apply(context,[true]);\r\n\t\t}, console.error);\r\n\t},  function(e){\r\n\t\tif (cb) cb.apply(context,[false]);//no such file\r\n\t});\r\n}\r\nfunction errorHandler(e) {\r\n\tconsole.error('Error: ' +e.name+ \" \"+e.message);\r\n}\r\nvar initfs=function(grantedBytes,cb,context) {\r\n\twebkitRequestFileSystem(PERSISTENT, grantedBytes,  function(fs) {\r\n\t\tAPI.fs=fs;\r\n\t\tAPI.quota=grantedBytes;\r\n\t\treaddir(function(){\r\n\t\t\tAPI.initialized=true;\r\n\t\t\tcb.apply(context,[grantedBytes,fs]);\r\n\t\t},context);\r\n\t}, errorHandler);\r\n}\r\nvar init=function(quota,cb,context) {\r\n\tif (!navigator.webkitPersistentStorage) return;\r\n\tnavigator.webkitPersistentStorage.requestQuota(quota,\r\n\t\t\tfunction(grantedBytes) {\r\n\t\t\t\tinitfs(grantedBytes,cb,context);\r\n\t\t}, errorHandler\r\n\t);\r\n}\r\nvar queryQuota=function(cb,context) {\r\n\tvar that=this;\r\n\tnavigator.webkitPersistentStorage.queryUsageAndQuota(\r\n\t function(usage,quota){\r\n\t\t\tinitfs(quota,function(){\r\n\t\t\t\tcb.apply(context,[usage,quota]);\r\n\t\t\t},context);\r\n\t});\r\n}\r\nvar API={\r\n\tinit:init\r\n\t,readdir:readdir\r\n\t,checkUpdate:checkUpdate\r\n\t,rm:rm\r\n\t,rmURL:rmURL\r\n\t,getFileURL:getFileURL\r\n\t,writeFile:writeFile\r\n\t,readFile:readFile\r\n\t,download:download\r\n\t,get_head:get_head\r\n\t,get_date:get_date\r\n\t,get_size:get_size\r\n\t,getDownloadSize:get_size\r\n\t,queryQuota:queryQuota\r\n}\r\nmodule.exports=API;\r\n",
    "var appname=\"installer\";\r\nif (typeof ksana==\"undefined\") {\r\n\twindow.ksana={platform:\"chrome\"};\r\n\tif (typeof process!==\"undefined\" && \r\n\t\tprocess.versions && process.versions[\"node-webkit\"]) {\r\n\t\twindow.ksana.platform=\"node-webkit\";\r\n\t}\r\n}\r\nvar switchApp=function(path) {\r\n\tvar fs=require(\"fs\");\r\n\tpath=\"../\"+path;\r\n\tappname=path;\r\n\tdocument.location.href= path+\"/index.html\"; \r\n\tprocess.chdir(path);\r\n}\r\nvar downloader={};\r\nvar rootPath=\"\";\r\n\r\nvar deleteApp=function(app) {\r\n\tconsole.error(\"not allow on PC, do it in File Explorer/ Finder\");\r\n}\r\nvar username=function() {\r\n\treturn \"\";\r\n}\r\nvar useremail=function() {\r\n\treturn \"\"\r\n}\r\nvar runtime_version=function() {\r\n\treturn \"1.4\";\r\n}\r\n\r\n//copy from liveupdate\r\nvar jsonp=function(url,dbid,callback,context) {\r\n  var script=document.getElementById(\"jsonp2\");\r\n  if (script) {\r\n    script.parentNode.removeChild(script);\r\n  }\r\n  window.jsonp_handler=function(data) {\r\n    if (typeof data==\"object\") {\r\n      data.dbid=dbid;\r\n      callback.apply(context,[data]);    \r\n    }  \r\n  }\r\n  window.jsonp_error_handler=function() {\r\n    console.error(\"url unreachable\",url);\r\n    callback.apply(context,[null]);\r\n  }\r\n  script=document.createElement('script');\r\n  script.setAttribute('id', \"jsonp2\");\r\n  script.setAttribute('onerror', \"jsonp_error_handler()\");\r\n  url=url+'?'+(new Date().getTime());\r\n  script.setAttribute('src', url);\r\n  document.getElementsByTagName('head')[0].appendChild(script); \r\n}\r\n\r\n\r\nvar loadKsanajs=function(){\r\n\r\n\tif (typeof process!=\"undefined\" && !process.browser) {\r\n\t\tvar ksanajs=require(\"fs\").readFileSync(\"./ksana.js\",\"utf8\").trim();\r\n\t\tdownloader=require(\"./downloader\");\r\n\t\tksana.js=JSON.parse(ksanajs.substring(14,ksanajs.length-1));\r\n\t\trootPath=process.cwd();\r\n\t\trootPath=require(\"path\").resolve(rootPath,\"..\").replace(/\\\\/g,\"/\")+'/';\r\n\t\tksana.ready=true;\r\n\t} else{\r\n\t\tvar url=window.location.origin+window.location.pathname.replace(\"index.html\",\"\")+\"ksana.js\";\r\n\t\tjsonp(url,appname,function(data){\r\n\t\t\tksana.js=data;\r\n\t\t\tksana.ready=true;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nloadKsanajs();\r\n\r\nvar boot=function(appId,cb) {\r\n\tif (typeof appId==\"function\") {\r\n\t\tcb=appId;\r\n\t\tappId=\"unknownapp\";\r\n\t}\r\n\tif (!ksana.js && ksana.platform==\"node-webkit\") {\r\n\t\tloadKsanajs();\r\n\t}\r\n\tksana.appId=appId;\r\n\tif (ksana.ready) {\r\n\t\tcb();\r\n\t\treturn;\r\n\t}\r\n\tvar timer=setInterval(function(){\r\n\t\t\tif (ksana.ready){\r\n\t\t\t\tclearInterval(timer);\r\n\t\t\t\tcb();\r\n\t\t\t}\r\n\t\t},100);\r\n}\r\n\r\n\r\nvar ksanagap={\r\n\tplatform:\"node-webkit\",\r\n\tstartDownload:downloader.startDownload,\r\n\tdownloadedByte:downloader.downloadedByte,\r\n\tdownloadingFile:downloader.downloadingFile,\r\n\tcancelDownload:downloader.cancelDownload,\r\n\tdoneDownload:downloader.doneDownload,\r\n\tswitchApp:switchApp,\r\n\trootPath:rootPath,\r\n\tdeleteApp: deleteApp,\r\n\tusername:username, //not support on PC\r\n\tuseremail:username,\r\n\truntime_version:runtime_version,\r\n\tboot:boot\r\n}\r\nmodule.exports=ksanagap;",
    "var started=false;\r\nvar timer=null;\r\nvar bundledate=null;\r\nvar get_date=require(\"./html5fs\").get_date;\r\nvar checkIfBundleUpdated=function() {\r\n\tget_date(\"bundle.js\",function(date){\r\n\t\tif (bundledate &&bundledate!=date){\r\n\t\t\tlocation.reload();\r\n\t\t}\r\n\t\tbundledate=date;\r\n\t});\r\n}\r\nvar livereload=function() {\r\n\tif(window.location.origin.indexOf(\"//127.0.0.1\")===-1) return;\r\n\r\n\tif (started) return;\r\n\r\n\ttimer1=setInterval(function(){\r\n\t\tcheckIfBundleUpdated();\r\n\t},2000);\r\n\tstarted=true;\r\n}\r\n\r\nmodule.exports=livereload;",
    "function mkdirP (p, mode, f, made) {\r\n     var path = nodeRequire('path');\r\n     var fs = nodeRequire('fs');\r\n\t\r\n    if (typeof mode === 'function' || mode === undefined) {\r\n        f = mode;\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    var cb = f || function () {};\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    fs.mkdir(p, mode, function (er) {\r\n        if (!er) {\r\n            made = made || p;\r\n            return cb(null, made);\r\n        }\r\n        switch (er.code) {\r\n            case 'ENOENT':\r\n                mkdirP(path.dirname(p), mode, function (er, made) {\r\n                    if (er) cb(er, made);\r\n                    else mkdirP(p, mode, cb, made);\r\n                });\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                fs.stat(p, function (er2, stat) {\r\n                    // if the stat fails, then that's super weird.\r\n                    // let the original error be the failure reason.\r\n                    if (er2 || !stat.isDirectory()) cb(er, made)\r\n                    else cb(null, made);\r\n                });\r\n                break;\r\n        }\r\n    });\r\n}\r\n\r\nmkdirP.sync = function sync (p, mode, made) {\r\n    var path = nodeRequire('path');\r\n    var fs = nodeRequire('fs');\r\n    if (mode === undefined) {\r\n        mode = 0x1FF & (~process.umask());\r\n    }\r\n    if (!made) made = null;\r\n\r\n    if (typeof mode === 'string') mode = parseInt(mode, 8);\r\n    p = path.resolve(p);\r\n\r\n    try {\r\n        fs.mkdirSync(p, mode);\r\n        made = made || p;\r\n    }\r\n    catch (err0) {\r\n        switch (err0.code) {\r\n            case 'ENOENT' :\r\n                made = sync(path.dirname(p), mode, made);\r\n                sync(p, mode, made);\r\n                break;\r\n\r\n            // In the case of any other error, just see if there's a dir\r\n            // there already.  If so, then hooray!  If not, then something\r\n            // is borked.\r\n            default:\r\n                var stat;\r\n                try {\r\n                    stat = fs.statSync(p);\r\n                }\r\n                catch (err1) {\r\n                    throw err0;\r\n                }\r\n                if (!stat.isDirectory()) throw err0;\r\n                break;\r\n        }\r\n    }\r\n\r\n    return made;\r\n};\r\n\r\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\r\n",
    "var React=require(\"react\");\r\nvar ReactDOM=require(\"react-dom\");\r\nrequire(\"ksana2015-webruntime/livereload\")(); \r\nvar ksanagap=require(\"ksana2015-webruntime/ksanagap\");\r\nksanagap.boot(\"taishonote\",function(){\r\n\tvar Main=React.createElement(require(\"./src/main.jsx\"));\r\n\tksana.mainComponent=ReactDOM.render(Main,document.getElementById(\"main\"));\r\n});",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\nvar TwoColumnMode=require(\"ksana2015-parallel\").TwoColumnMode;\r\n\r\nvar rule=require(\"./rule\");\r\nvar leftDocs=[{name:\"T01/T01n0001_001\",label:\"經\",rule},\r\n{name:\"lun\",label:\"論\",rule}],\r\n rightDocs=[{name:\"T01/T01n0001_001\",label:\"經\",rule},\r\n {name:\"lun\",label:\"論\",rule}];\r\n// ,{name:\"eng\",label:\"英\",rule}];\r\nvar leftDoc=\"T01/T01n0001_001\",rightDoc=\"\",\r\nleftView=\"taisho\",rightView=\"taisho\",\r\nleftMenu=require(\"./toprightmenu\"),rightMenu=null;\r\n\r\nvar maincomponent = React.createClass({displayName: \"maincomponent\",\r\n  getInitialState:function() {\r\n    return {};\r\n  }\r\n  ,render: function() {\r\n    return E(TwoColumnMode,{\r\n      leftDocs,rightDocs,leftDoc,rightDoc,\r\n      leftMenu,rightMenu,leftView,rightView});\r\n  }\r\n});\r\nmodule.exports=maincomponent;",
    "var actionhandler=null;\r\nvar codec=require(\"../../cbeta-address/codec\");//shoudl move to node_modules\r\nvar getFileStart=function(){\r\n\treturn codec.pack(\"01p0001a0000\");\r\n}\r\nvar breakline=function(file,by){\r\n\tvar breaker=file[by];\r\n\tvar out=\"\",offset=0;\r\n\tfor (var i=0;i<breaker.length;i++){\r\n\t\tout+=file.content.substr(offset,breaker[i])+\"\\n\";\r\n\t\toffset+=breaker[i];\r\n\t}\r\n\treturn out;\r\n}\r\n\r\nvar setActionHandler=function(_actionhandler){\r\n\tactionhandler=_actionhandler;\r\n}\r\n\r\nmodule.exports={setActionHandler,breakline,getFileStart,\r\n\tnextLine:codec.nextLine,formatPointer:codec.unpack};",
    "var React=require(\"react\");\r\nvar E=React.createElement;\r\nvar PT=React.PropTypes;\r\n\r\nvar TopRightMenu=React.createClass({displayName: \"TopRightMenu\",\r\n\tcontextTypes:{\r\n\t\taction:PT.func.isRequired\r\n\t},\r\n\tgetInitialState:function(){\r\n\t\treturn {breakby:\"lb\"}\r\n\t},\r\n\ttoggleLayout:function(){\r\n\t\tvar breakby=this.state.breakby==\"lb\"?\"p\":\"lb\"\r\n\t\tthis.context.action(\"layout\",breakby);\r\n\t\tthis.setState({breakby});\r\n\t},\r\n\ttoggleLineNumber:function(){\r\n\t\tthis.context.action(\"toggleLineNumber\",0);\r\n\t},\r\n\trender:function(){\r\n\t\tvar label={\"lb\":\"原書\",\"p\":\"段落\"}[this.state.breakby];\r\n\t\treturn (\r\n\t\t\tE(\"div\",{style:styles.container},\r\n\t\t\t\tE(\"div\",{style:styles.viewcontrols},\r\n\t\t\t\t\tE(\"button\",{onClick:this.toggleLineNumber},\"行標\"),\r\n\t\t\t\t\tE(\"button\",{onClick:this.toggleLayout},label)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n});\r\n\r\nvar styles={\r\n\tbutton:{fontSize:20,borderRadius:\"10%\"},\r\n\tselectedButton:{background:\"blue\",color:\"white\"},\r\n\tcontainer:{position:\"relative\",zIndex:100,opacity:0.7},\r\n\tviewcontrols:{position:\"absolute\",right:20,top:5} //for scrollbar\r\n}\r\n\r\nmodule.exports=TopRightMenu;"
  ]
}